- hosts: all
  pre_tasks:
    - name: "test"
      lineinfile: dest=/etc/hosts regexp='.*{{ item }}$' line="{{ hostvars[item].ansible_default_ipv4.address }} {{hostvars[item].ansible_hostname}}" state=present
      with_items: "{{ groups['all'] }}"
      when: hostvars[item].ansible_default_ipv4.address is defined
